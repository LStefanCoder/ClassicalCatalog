<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/piece.css" rel="stylesheet" >
    <script src="../js/bootstrap.min.js"></script>
    
    
    <script src="../../js/opensheetmusicdisplay.min.js"></script>
    

    <title>Main page</title>
</head>
<body>
    <!--the back arrow redirects to the original page-->
    <a href="<%= previousURL %>"><img src="../svg/left-arrow-circle2-svgrepo-com.svg" alt="" style="height: 50px" class="pdfIcon"></a>
    <h1><%= result['Title'] %></h1>
    <h2>Composed by <%= result['Composer'] %></h2>
    <p><a href="<%= result['Link'] %>">Source: <%= result['Link'] %></a></p>
    <p>Genre: <%= result['Genre'] %></p>
    <p>Key: <%= result['Key'] %></p>
    <p>Instruments: <%= result['Instruments'] %></p>
    <p>Year: <%= result['Year'] %></p>
    <!--PDF icon from svgrepo.com, CC0 license-->
    <!--the link to the PDF file of the score-->
    <p><a href="/works/<%= result['ID'] %>/pdf""><img src="../svg/pdf-file-format-symbol-svgrepo-com.svg" alt="" style="height: 50px" class="pdfIcon"></a></p>
    <a href="/works/<%= result['ID'] %>/xml">XML file</a>

    <!--this page leads the user to further information about the composer-->
    <p><a href="/composers/<%= composer['ID'] %>">Information about the composer</a></p>


    <!--this div contains the score as rendered by OSMD-->
    <!--the height of the score can be adjusted here-->
    <div id="sheetMusicContainer" style="height: 100px"></div>

    <!--this code will show the first page of the score-->
    <!--<script>
      //the OSMD standard code, taken from the main wiki

      var osmd = new opensheetmusicdisplay.OpenSheetMusicDisplay("sheetMusicContainer");
        osmd.setOptions({
          //all options see https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/blob/master/src/OpenSheetMusicDisplay/OSMDOptions.ts
          backend: "svg",
          //disabled, because the credits are already displayed above
          drawCredits: false,
          drawingParameters: "compacttight" // don't display title, composer etc., smaller margins
        });
        osmd
          .load(XMLString)
          .then(
            function() {
              osmd.render(); 
            }
          );
    </script>-->
    
    <!--the unused Opensheetmusicdisplay code-->    

    <!--contains the XML data-->
    <div id="sheetMusicContainer" style="height: 100px">
    </div>
    <script>
      
        var XMLStartString = `<%= result['XML'] %>`;
        var XMLUnescapedString = XMLStartString.replace(/&amp;/g, '&')
  .replace(/&lt;/g, '<')
  .replace(/&gt;/g, '>')
  .replace(/&quot;/g, '"')
  .replace(/&#34;/g, '"')
  .replace(/&#39;/g, "'");;
        //var XMLString1 = new DOMParser().parseFromString(XMLUnescapedString, "text/xml");

        

        var XMLString = XMLUnescapedString;
        //console.log(XMLString);
        /*//first, we assign the XML variable to a string
        var XMLStartString = `<%= result['XML'] %>`;
        var XMLString1 = new DOMParser().parseFromString(XMLStartString, "text/xml");
        var XMLString2 = XMLString1.documentElement.textContent;
        console.log(XMLString2);*/

        //var osmd = new opensheetmusicdisplay.OpenSheetMusicDisplay("sheetMusicContainer");
        var osmd = new opensheetmusicdisplay.OpenSheetMusicDisplay("sheetMusicContainer");
        osmd.setOptions({
          //all options see https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/blob/master/src/OpenSheetMusicDisplay/OSMDOptions.ts
          backend: "svg",
          //disabled, because the credits are already displayed above
          drawCredits: false,
          drawingParameters: "compacttight", // don't display title, composer etc., smaller margins
          drawUpToMeasureNumber: 2
        });
        osmd
          .load(XMLString)
          .then(
            function() {
              osmd.render(); 
            }
          );
      </script>

</body>
</html>


<!--see image here: https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/issues/658
https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/blob/4068565/src/MusicalScore/Graphical/EngravingRules.ts#L443
MaxPageToDrawNumber here https://opensheetmusicdisplay.github.io/classdoc/classes/EngravingRules.html#MaxPageToDrawNumber-->