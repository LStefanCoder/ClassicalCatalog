<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="js/bootstrap.min.js"></script>-->
    <!--<script src="../scripts/opensheetmusicdisplay.min.js"></script>-->
    <script src="https://unpkg.com/opensheetmusicdisplay@0.8.3/build/opensheetmusicdisplay.min.js"></script>
    <title>Main page</title>
</head>
<body>
    <h1><%= result['Title'] %></h1>
    <h2>Composed by <%= result['Composer'] %></h2>
    <p>Genre: <%= result['Genre'] %></p>
    <p>Year of composition: <%= result['Year'] %></p>
    <p><a href="/works/<%= result['ID'] %>/pdf"">PDF link</a></p>
    <!--contains the XML data-->
    <div id="xmlDiv" style="visibility: hidden;">
      <%= result['XML'] %>
    </div>
    <div id="sheetMusicContainer">
    </div>
    <script>
      //unescaping of HTML entities see here https://www.geeksforgeeks.org/how-to-escape-unescape-html-characters-in-string-in-javascript/
        var XMLStartString = document.getElementById('xmlDiv').innerHTML.replace(/&amp;/g, '&')
  .replace(/&lt;/g, '<')
  .replace(/&gt;/g, '>')
  .replace(/&quot;/g, '"')
  .replace(/&#39;/g, "'");;
        var XMLString1 = new DOMParser().parseFromString(XMLStartString, "text/xml");

        var XMLString = XMLStartString;
        console.log(XMLString);
        /*//first, we assign the XML variable to a string
        var XMLStartString = `<%= result['XML'] %>`;
        var XMLString1 = new DOMParser().parseFromString(XMLStartString, "text/xml");
        var XMLString2 = XMLString1.documentElement.textContent;
        console.log(XMLString2);*/
        var osmd = new opensheetmusicdisplay.OpenSheetMusicDisplay("sheetMusicContainer");
        osmd.setOptions({
          backend: "svg",
          drawTitle: true,
          // drawingParameters: "compacttight" // don't display title, composer etc., smaller margins
        });
        osmd
        //these quotes are necessary
          .load(XMLString)
          .then(
            function() {
              osmd.render(); 
            }
          );
      </script>
        
</body>
</html>